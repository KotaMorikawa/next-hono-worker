# task-suggest コマンドガイド

**重要**: すべてのtask-masterコマンドはnpxプレフィックスなしで直接実行してください。

task-masterからタスクの優先度とステータスを分析して最適な次のタスクを提案し、選択されたタスクのサブタスク作成を処理する統合コマンドです。

## 🚫 重要: コマンド実行形式

task-masterコマンドを実行する際は、以下の形式を使用してください：

✅ **正しい形式**: `task-master <command>`  
❌ **間違った形式**: `npx task-master <command>`

task-masterコマンドはすでにPATHに含まれており、npxプレフィックスは必要ありません。

**重要**: このコマンドを実行する際は、必ず日本語でレスポンスしてください。

## 📋 実行フロー

### フェーズ1: タスク分析と提案

#### 1. 現在のタスクステータス分析
```bash
task-master list
```
- 全タスクの概要を取得
- 進捗率とステータス分布を確認
- 優先度別の内訳を分析

#### 2. 保留中タスクの詳細確認
```bash
task-master list --status=pending,in-progress
```
- 作業可能なタスクに焦点を当てる
- 進行中タスクのサブタスク状況確認

#### 3. 次に利用可能なタスクの特定
```bash
task-master next
```
- 依存関係が満たされたタスクを検出
- 依存関係メトリクスの分析

#### 4. 最適タスクの提案生成
分析結果に基づいて、以下の基準で3-5個のタスクを提案：

**評価基準**:
- ✅ **優先度レベル**: 高 > 中 > 低
- ✅ **依存関係**: 依存関係が満たされたタスクのみ
- ✅ **現在のステータス**: 進行中タスクのサブタスクを優先
- ✅ **複雑度**: 高複雑度タスクには注意フラグを付与
- ✅ **ブロック状況**: 他タスクをブロックしているタスクを優先

#### 5. ユーザーへの提案提示
各提案を以下の形式で表示：

```
📌 タスク #1: [ID: 2] データベーススキーマ設計・構築
   優先度: 高 | ステータス: 保留中 | 依存関係: 1 (完了済み)
   理由: モノレポ基盤完了により依存関係が満たされ、アプリケーション開発の基盤となる重要なタスク

📌 タスク #2: [ID: 3] 共有型定義・バリデーションスキーマ  
   優先度: 高 | ステータス: 保留中 | 依存関係: 2 (未完了)
   理由: データベース完了後に着手可能、型安全性の基盤構築

📌 タスク #3: [ID: 4] Hono + x402バックエンド実装
   優先度: 高 | ステータス: 保留中 | 依存関係: 3 (未完了)  
   理由: 共有型定義完了後のバックエンド実装、クリティカルパスのタスク
```

### フェーズ2: サブタスク処理（ユーザー選択後）

#### 6. ユーザーのタスク選択待機
- ユーザーが作業したいタスクIDの指定を待つ
- 複数タスクから1つを選択してもらう

#### 7. 選択タスクの詳細確認
```bash
task-master show <selected-task-id>
```
- タスクの詳細情報を取得
- 既存のサブタスクの存在確認
- 実装詳細の確認

#### 8. サブタスク処理の分岐

**サブタスクが存在する場合**:
- 既存のサブタスクリストを表示
- 各サブタスクの状況を確認
- ユーザーに次のアクションを確認

**サブタスクが存在しない場合**:
- タスク要件に基づいてサブタスクを自動生成
- 実装可能な単位に分割
- 論理的な順序で整理

```bash
# サブタスク追加の例
task-master add-subtask --parent=<task-id> --title="<subtask-title>" --description="<詳細説明>"

# または自動展開
task-master expand --id=<task-id> --num=5
```

#### 9. タスクステータスの更新
```bash
# 選択されたタスクを進行中としてマーク
task-master set-status --id=<task-id> --status=in-progress

# 最初のサブタスクも進行中としてマーク（該当する場合）
task-master set-status --id=<subtask-id> --status=in-progress
```

## 🎯 使用方法

### 基本実行
```bash
/task-suggest
```

### 実行される処理フロー
1. 📊 現在のタスクステータスと優先度を分析
2. 🎯 理由付きで3-5個の最適なタスクを提案  
3. ⏳ タスク選択をユーザーから待機
4. 🔧 選択されたタスクのサブタスクを確認/作成
5. ✅ タスクステータスを適切に更新

## 📤 期待される出力結果

### フェーズ1の出力例:
```
📊 現在のプロジェクト状況
- 全体進捗: 10% (1/10タスク完了)
- 保留中: 9タスク | 進行中: 0タスク | 完了: 1タスク

🎯 推奨タスク提案

📌 タスク #1: [ID: 2] データベーススキーマ設計・構築
   優先度: 高 | ステータス: 保留中
   理由: 依存関係(タスク#1)完了済み、アプリケーション開発の基盤となる重要なタスク

📌 タスク #2: [ID: 3] 共有型定義・バリデーションスキーマ
   優先度: 高 | ステータス: 保留中  
   理由: データベース完了後に着手可能、型安全性確保の基盤

📌 タスク #3: [ID: 6] LLM統合・自然言語API生成エンジン
   優先度: 中 | ステータス: 保留中
   理由: 並行して研究・設計を開始可能、技術調査が必要

作業したいタスクのIDを選択してください（例: 2）
```

### フェーズ2の出力例:
```
✅ タスク #2 が選択されました

📋 サブタスクリスト:
1. Drizzle ORM設定とスキーマ定義
2. ユーザー管理テーブル作成 (users, organizations)
3. API管理テーブル作成 (api_keys, generated_apis)  
4. 使用量追跡テーブル作成 (api_usage, billing_records)
5. 学習進捗テーブル作成 (learning_progress, tutorial_completion)

🔄 ステータス更新完了:
- タスク #2: pending → in-progress
- サブタスク #2.1: → in-progress

🚀 次のアクション:
Drizzle ORM設定とスキーマ定義から開始してください
```

## ⚠️ 重要な注意事項

### 除外条件
- ❌ 依存関係が満たされていないタスクは提案から除外
- ❌ すでに完了したタスクは除外
- ❌ キャンセルまたは延期されたタスクは除外

### 優先順位
- 🔥 進行中タスクのサブタスクが最優先
- 📈 高優先度 > 中優先度 > 低優先度
- 🔗 クリティカルパス上のタスクを優先
- 🚫 他タスクをブロックしているタスクを優先

### 完了時の処理
- ✅ すべてのタスクが完了している場合は完了メッセージを表示
- 🎉 プロジェクト完了の祝福メッセージ
- 📊 最終的な統計情報の表示

### サブタスク作成の原則
- 🧩 複雑なタスクを管理可能な単位に分解
- 📝 各サブタスクは独立して実行可能
- 🔄 論理的な実行順序を考慮
- ⏱️ 適切な作業時間（1-4時間程度）に調整

## 🔧 高度な使用例

### 特定の条件でのタスク分析
```bash
# 高優先度タスクのみを分析
task-master list --status=pending | grep "high"

# 依存関係の詳細確認
task-master show <task-id>

# 複雑なタスクの自動展開
task-master expand --id=<task-id> --num=7 --research
```

### カスタムワークフロー
```bash
# 1. 分析実行
/task-suggest

# 2. タスク選択（例: ID=2）
2

# 3. 詳細確認
task-master show 2

# 4. サブタスク展開（必要に応じて）
task-master expand --id=2 --num=5

# 5. 作業開始
task-master set-status --id=2 --status=in-progress
```

## 📚 関連コマンド

- `task-master list` - タスク一覧表示
- `task-master next` - 次のタスク確認  
- `task-master show <id>` - タスク詳細表示
- `task-master expand --id=<id>` - タスク展開
- `task-master set-status` - ステータス更新
- `task-master add-subtask` - サブタスク追加

詳細なコマンドヘルプは `task-master --help` または `task-master <command> --help` で確認してください。